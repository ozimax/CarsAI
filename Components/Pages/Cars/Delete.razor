@page "/cars/delete/{id:int}"
@inject ICarService CarService
@inject NavigationManager Navigation

<PageTitle>Delete Car</PageTitle>

<h1>Delete Car</h1>

@if (car is null)
{
    <p>Car not found.</p>
}
else
{
    <h3>Are you sure you want to delete this car?</h3>

    <dl class="row">
        <dt class="col-sm-3">Make</dt>
        <dd class="col-sm-9">@car.Make</dd>

        <dt class="col-sm-3">Model</dt>
        <dd class="col-sm-9">@car.Model</dd>

        <dt class="col-sm-3">Year</dt>
        <dd class="col-sm-9">@car.Year</dd>

        <dt class="col-sm-3">Driver Name</dt>
        <dd class="col-sm-9">@car.DriverName</dd>

        <dt class="col-sm-3">Plate Number</dt>
        <dd class="col-sm-9">@car.PlateNumber</dd>
    </dl>

    <button class="btn btn-danger" @onclick="DeleteCar">Delete</button>
    <a class="btn btn-secondary ms-2" href="/cars">Cancel</a>
}

@if (!string.IsNullOrWhiteSpace(error))
{
    <div class="alert alert-danger mt-3">@error</div>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private Car? car;
    private string? error;

    protected override async Task OnInitializedAsync()
    {
        car = await CarService.GetByIdAsync(Id);
    }

    private async Task DeleteCar()
    {
        if (car is null)
        {
            return;
        }

        var result = await CarService.DeleteAsync(Id);
        if (!result.Success)
        {
            error = result.Error;
            return;
        }

        Navigation.NavigateTo("/cars");
    }
}
